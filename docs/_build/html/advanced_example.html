

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced example &mdash; Chemical kinetics 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Documentation" href="docs.html" />
    <link rel="prev" title="Simple example" href="simple_example.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Chemical kinetics
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="simple_example.html">Simple example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#kinetic-model">Kinetic model</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-concentrations-and-charge-passed-evolution-over-time">Load concentrations and charge passed evolution over time</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting">Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fit-results">Fit results</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="docs.html">Documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Chemical kinetics</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Advanced example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/advanced_example.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-example">
<h1>Advanced example<a class="headerlink" href="#advanced-example" title="Permalink to this headline">¶</a></h1>
<p>This example emphasizes two scenarii not covered in the simple example:</p>
<ul class="simple">
<li><p>using charge passed over time data, which can be acquired when performing electrochemical measurements (chronocoulometry), and that can help improve the accuracy of the time constants obtained from the fit</p></li>
<li><p>fitting when the concentration evolution over time experimental data only covers some of the species considered in the model</p></li>
</ul>
<div class="section" id="kinetic-model">
<h2>Kinetic model<a class="headerlink" href="#kinetic-model" title="Permalink to this headline">¶</a></h2>
<p>The kinetics model derived in <a class="reference external" href="TODOaddlinkwhenpublished">this paper</a> leads to the following set of differential equations:</p>
<div class="math notranslate nohighlight">
\[\frac{d[HMF]}{dt} = -(k_{\textbf{1}1} + k_{\textbf{1}2} + k_{H\textbf{1}})[HMF]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[DFF]}{dt} = k_{\textbf{1}1}[HMF] - (k_{\textbf{2}1} + k_{H\textbf{2}1})[DFF]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[HMFCA]}{dt} = k_{\textbf{1}2}[HMF] - (k_{\textbf{2}2} + k_{H\textbf{2}2})[HMFCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[FFCA]}{dt} = k_{\textbf{2}1}[DFF] + k_{\textbf{2}2}[HMFCA] - (k_{\textbf{3}} + k_{H\textbf{3}})[FFCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[FDCA]}{dt} = k_{\textbf{3}}[FFCA] - k_{H\textbf{4}}[FDCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[humins]}{dt} = k_{H\textbf{1}}[HMF] + k_{H\textbf{2}1}[DFF] + k_{H\textbf{2}2}[HMFCA]\]</div>
<div class="math notranslate nohighlight">
\[+ k_{H\textbf{3}}[FFCA] + k_{H\textbf{4}}[FDCA] - k_{H^*}[humins]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[humins^*]}{dt} = k_{H^*}[humins]\]</div>
<p>In order to write a function describing this model we need to define all the species whose concentrations evolution over time are considered in this study. In that case 5 species concentrations were tracked by HPLC measurements (HMF, DFF, HMFCA, FFCA, FDCA). The humins and electropolymerized humins (humins*) concentrations could not be tracked. For the untracked species we need to consider 10 additional concentrations. Indeed, in the differential equations mentionned above only the total concentration evolution of humins and humins* (electropolymerized humins) are considered. However, these total humins and humins* concentrations need to be splitted here into the individual concentrations coming from each individual humins formation reactions. This is required because humins species formed through different reaction pathways will involve a different amount of charge passed in our electrochemical measurement. With these individual concentrations we are able to calculate the amount of charge passed over time allowing us to include the corresponding experimental data in the fit.</p>
<p>We define the species names considered in this experiment as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">species_tracked</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;HMF&quot;</span><span class="p">,</span> <span class="s2">&quot;DFF&quot;</span><span class="p">,</span> <span class="s2">&quot;HMFCA&quot;</span><span class="p">,</span> <span class="s2">&quot;FFCA&quot;</span><span class="p">,</span> <span class="s2">&quot;FDCA&quot;</span>
<span class="p">]</span>
<span class="n">species_untracked</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;H_HMF&quot;</span><span class="p">,</span>  <span class="s2">&quot;H_DFF&quot;</span><span class="p">,</span>  <span class="s2">&quot;H_HMFCA&quot;</span><span class="p">,</span>  <span class="s2">&quot;H_FFCA&quot;</span><span class="p">,</span>  <span class="s2">&quot;H_FDCA&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Hx_HMF&quot;</span><span class="p">,</span> <span class="s2">&quot;Hx_DFF&quot;</span><span class="p">,</span> <span class="s2">&quot;Hx_HMFCA&quot;</span><span class="p">,</span> <span class="s2">&quot;Hx_FFCA&quot;</span><span class="p">,</span> <span class="s2">&quot;Hx_FDCA&quot;</span>
<span class="p">]</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">species_tracked</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">species</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">species_untracked</span><span class="p">)</span>
</pre></div>
</div>
<p>HMF, DFF, HMFCA, FFCA and FDCA are the species whose concentrations are tracked experimentally. The humins and humins* coming from these species are denoted with the same names prepended respectively with a “H<em>” and a “Hx</em>”. To sum up we can now write:</p>
<div class="math notranslate nohighlight">
\[[humins] = [H\_HMF] + [H\_DFF] + [H\_HMFCA] + [H\_FFCA] + [H\_FDCA]\]</div>
<div class="math notranslate nohighlight">
\[[humins^*] = [Hx\_HMF] + [Hx\_DFF] + [Hx\_HMFCA] + [Hx\_FFCA] + [Hx\_FDCA]\]</div>
<p>Therefore, the derivatives presented above for the concentration of humins are rewritten in the following way:</p>
<div class="math notranslate nohighlight">
\[\frac{d[H\_HMF]}{dt} = k_{H\textbf{1}}[HMF] - k_{H^*}[H\_HMF]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[H\_DFF]}{dt} = k_{H\textbf{1}}[DFF] - k_{H^*}[H\_DFF]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[H\_HMFCA]}{dt} = k_{H\textbf{1}}[HMFCA] - k_{H^*}[H\_HMFCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[H\_FFCA]}{dt} = k_{H\textbf{1}}[FFCA] - k_{H^*}[H\_FFCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[H\_FDCA]}{dt} = k_{H\textbf{1}}[FDCA] - k_{H^*}[H\_FDCA]\]</div>
<p>The derivatives for the concentration of humins* are rewritten in this way:</p>
<div class="math notranslate nohighlight">
\[\frac{d[Hx\_HMF]}{dt} = k_{H^*}[H\_HMF]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[Hx\_DFF]}{dt} = k_{H^*}[H\_DFF]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[Hx\_HMFCA]}{dt} = k_{H^*}[H\_HMFCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[Hx\_FFCA]}{dt} = k_{H^*}[H\_FFCA]\]</div>
<div class="math notranslate nohighlight">
\[\frac{d[Hx\_FDCA]}{dt} = k_{H^*}[H\_FDCA]\]</div>
<p>We can now write the “derivatives” function derived from these differential equations:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">derivatives</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Calculates the derivatives of the concentrations at t</span>

<span class="sd">    Used scipy.integrate.odeint to numerically solve the differential</span>
<span class="sd">    equations in a given time range.</span>

<span class="sd">    Lists (&quot;y&quot; and &quot;dy&quot;) used by scipy.integrate.odeint are converted</span>
<span class="sd">    to dictionaries (&quot;c&quot; and &quot;dc&quot;) in order to make the differentials</span>
<span class="sd">    easier to write and read for humans.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        y (list): concentration values at t</span>
<span class="sd">        t (float): time value where the derivatives are calculated</span>
<span class="sd">        p (dict): dictionary containing the parameters used to</span>
<span class="sd">        calculate the derivatives e.g. time constants</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">c</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">)}</span>

    <span class="n">dc</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;HMF&quot;</span><span class="p">]</span>      <span class="o">=</span>  <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;k11&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;k12&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH1&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMF&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;DFF&quot;</span><span class="p">]</span>      <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;k11&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMF&quot;</span><span class="p">]</span>                       <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;k21&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH21&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;DFF&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;HMFCA&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;k12&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMF&quot;</span><span class="p">]</span>                       <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;k22&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH22&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMFCA&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;FFCA&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;k21&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;DFF&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;k22&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMFCA&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;k3&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH3&quot;</span><span class="p">])</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;FFCA&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;FDCA&quot;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;k3&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;FFCA&quot;</span><span class="p">]</span>                       <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH4&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;FDCA&quot;</span><span class="p">]</span>

    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;H_HMF&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH1&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMF&quot;</span><span class="p">]</span>    <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_HMF&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;H_DFF&quot;</span><span class="p">]</span>    <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH21&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;DFF&quot;</span><span class="p">]</span>   <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_DFF&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;H_HMFCA&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH22&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;HMFCA&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_HMFCA&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;H_FFCA&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH3&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;FFCA&quot;</span><span class="p">]</span>   <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_FFCA&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;H_FDCA&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kH4&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;FDCA&quot;</span><span class="p">]</span>   <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_FDCA&quot;</span><span class="p">]</span>

    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;Hx_HMF&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_HMF&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;Hx_DFF&quot;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_DFF&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;Hx_HMFCA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_HMFCA&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;Hx_FFCA&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_FFCA&quot;</span><span class="p">]</span>
    <span class="n">dc</span><span class="p">[</span><span class="s2">&quot;Hx_FDCA&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;kHx&quot;</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="p">[</span><span class="s2">&quot;H_FDCA&quot;</span><span class="p">]</span>

    <span class="n">dy</span> <span class="o">=</span> <span class="p">[</span><span class="n">dc</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">species</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">dy</span>
</pre></div>
</div>
<p>We can then convert the concentrations evolution over time into the charge passed over time using this equation:</p>
<div class="math notranslate nohighlight">
\[Q = e N_A V \sum_i n_i C_i\]</div>
<p>With e the electron charge in Coulombs, N<span class="raw-html-m2r"><sub>A</sub></span> the Avogadro number, V the volume of solution, n<span class="raw-html-m2r"><sub>i</sub></span> the number of charge passed to make one molecule of i, and C<span class="raw-html-m2r"><sub>i</sub></span> the concentration of species i. This equation translates into code as follow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.constants</span> <span class="k">as</span> <span class="nn">constants</span>

<span class="k">def</span> <span class="nf">c_to_q</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Calculates the charge passed from the concentrations vs time</span>

<span class="sd">    Arguments:</span>
<span class="sd">        c (numpy.ndarray):</span>
<span class="sd">            Concentrations evolution over time, axis 0 is time,</span>
<span class="sd">            axis 1 is species.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># the concentrations are monitored in micromoles/L</span>
    <span class="c1"># so we convert them to moles/L</span>
    <span class="n">c</span> <span class="o">*=</span> <span class="mf">1e-6</span>

    <span class="c1"># calculate the product ni*Ci for each species</span>
    <span class="n">ni_Ci</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
        <span class="n">ni_Ci</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">c</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>

    <span class="c1"># calculate the sum of ni*Ci for all species</span>
    <span class="n">sum_ni_Ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ni_Ci</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># solution volume in L</span>
    <span class="n">V</span> <span class="o">=</span> <span class="mf">100e-3</span>

    <span class="c1"># charge passed in C</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">e</span><span class="o">*</span><span class="n">constants</span><span class="o">.</span><span class="n">N_A</span><span class="o">*</span><span class="n">V</span><span class="o">*</span><span class="n">sum_ni_Ci</span>

    <span class="k">return</span> <span class="n">q</span>
</pre></div>
</div>
<p>Now that the model is defined we can load the raw data and fit it.</p>
</div>
<div class="section" id="load-concentrations-and-charge-passed-evolution-over-time">
<h2>Load concentrations and charge passed evolution over time<a class="headerlink" href="#load-concentrations-and-charge-passed-evolution-over-time" title="Permalink to this headline">¶</a></h2>
<p>Here three .csv files are used to get the measured evolution of HMF, DFF, HMFCA, FFCA and FDCA concentrations over time. Three additional .csv files are used for the charge passed over time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chemical_kinetics</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">folders</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;data/run</span><span class="si">{i}</span><span class="s2">/&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">files_c</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{folder}</span><span class="s2">Reaction Monitoring.csv&quot;</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">]</span>
<span class="n">files_q</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{folder}</span><span class="s2">Charge Passed.csv&quot;</span> <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">]</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
    <span class="n">files_c</span> <span class="o">=</span> <span class="n">files_c</span><span class="p">,</span>
    <span class="n">files_q</span> <span class="o">=</span> <span class="n">files_q</span><span class="p">,</span>
    <span class="n">t_label</span> <span class="o">=</span> <span class="s2">&quot;Time [h]&quot;</span><span class="p">,</span>
    <span class="n">c_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Concentration [:math:`\rm\mu`M]&quot;</span><span class="p">,</span>
    <span class="n">q_label</span> <span class="o">=</span> <span class="s2">&quot;Charge passed [C]&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="fitting">
<h2>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h2>
<p>The only parameters to be fitted are the time constants. The initial concentrations are fixed to the initial values recorded by HPLC for the tracked species. For the untracked species the initial concentrations are fixed to 0.</p>
<p>We first define the time constants parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameter_args</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">parameter_names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;k11&quot;</span><span class="p">,</span><span class="s2">&quot;k12&quot;</span><span class="p">,</span><span class="s2">&quot;k21&quot;</span><span class="p">,</span><span class="s2">&quot;k22&quot;</span><span class="p">,</span><span class="s2">&quot;k3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kH1&quot;</span><span class="p">,</span><span class="s2">&quot;kH21&quot;</span><span class="p">,</span><span class="s2">&quot;kH22&quot;</span><span class="p">,</span><span class="s2">&quot;kH3&quot;</span><span class="p">,</span><span class="s2">&quot;kH4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kHx&quot;</span>
    <span class="p">]</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">parameter_args</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parameter_names</span><span class="p">}</span>
</pre></div>
</div>
<p>Then we define the initial concentrations parameter for the tracked species:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c0</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">vary</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">species_tracked</span><span class="p">}</span>
</pre></div>
</div>
<p>And finally, we define the initial concentrations for the untracked species (note that we need here to define an ordered dictionary):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="n">c0_untracked</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">({</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">vary</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">species_untracked</span>
<span class="p">})</span>
</pre></div>
</div>
<p>With the data loaded, the model defined and the parameters / initial concentrations initialized we can proceed with the fit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chemical_kinetics</span> <span class="kn">import</span> <span class="n">fit</span>

<span class="n">fit</span><span class="o">.</span><span class="n">fit_dataset</span><span class="p">(</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">ds</span><span class="p">,</span>
    <span class="n">derivatives</span> <span class="o">=</span> <span class="n">derivatives</span><span class="p">,</span>
    <span class="n">c_to_q</span> <span class="o">=</span> <span class="n">c_to_q</span><span class="p">,</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="n">parameters</span><span class="p">,</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">c0</span><span class="p">,</span>
    <span class="n">c0_untracked</span> <span class="o">=</span> <span class="n">c0_untracked</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span>Fit succeeded.
</pre></div>
</div>
</div>
<div class="section" id="fit-results">
<h2>Fit results<a class="headerlink" href="#fit-results" title="Permalink to this headline">¶</a></h2>
<p>The fit results are summarized in the table below. Note that all the initial concentrations (parameters starting with the string “<a href="#id1"><span class="problematic" id="id2">c0_</span></a>”) are fixed so only the ks values are varying parameters in this fit.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="o">.</span><span class="n">print_result</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class = 'docutils'>
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>value</th>
      <th>stderr</th>
      <th>stderr/value %</th>
      <th>init. val.</th>
      <th>vary</th>
      <th>min</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>k11</td>
      <td>0.00554</td>
      <td>0.000195</td>
      <td>3.51</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>1</th>
      <td>k12</td>
      <td>0.00182</td>
      <td>5.25e-05</td>
      <td>2.89</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>2</th>
      <td>k21</td>
      <td>0.0649</td>
      <td>0.00324</td>
      <td>5.0</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>3</th>
      <td>k22</td>
      <td>0.0381</td>
      <td>0.00215</td>
      <td>5.65</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>4</th>
      <td>k3</td>
      <td>0.00731</td>
      <td>0.000391</td>
      <td>5.35</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>5</th>
      <td>kH1</td>
      <td>0.0302</td>
      <td>0.000371</td>
      <td>1.23</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>6</th>
      <td>kH21</td>
      <td>0.0436</td>
      <td>0.00652</td>
      <td>15.0</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>7</th>
      <td>kH22</td>
      <td>1.68e-07</td>
      <td>0.00129</td>
      <td>7.65e+05</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>8</th>
      <td>kH3</td>
      <td>0.0545</td>
      <td>0.0031</td>
      <td>5.69</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>9</th>
      <td>kH4</td>
      <td>0.0728</td>
      <td>0.00591</td>
      <td>8.12</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>10</th>
      <td>kHx</td>
      <td>0.00173</td>
      <td>0.00027</td>
      <td>15.6</td>
      <td>0.05</td>
      <td>True</td>
      <td>0.0</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>11</th>
      <td>c0_HMF</td>
      <td>4.86e+03</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.86e+03</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>12</th>
      <td>c0_DFF</td>
      <td>4.57</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.57</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>13</th>
      <td>c0_HMFCA</td>
      <td>0.453</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.453</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>14</th>
      <td>c0_FFCA</td>
      <td>0.248</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.248</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>15</th>
      <td>c0_FDCA</td>
      <td>0.112</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.112</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>16</th>
      <td>c0_H_HMF</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>17</th>
      <td>c0_H_DFF</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>18</th>
      <td>c0_H_HMFCA</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>19</th>
      <td>c0_H_FFCA</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>20</th>
      <td>c0_H_FDCA</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>21</th>
      <td>c0_Hx_HMF</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>22</th>
      <td>c0_Hx_DFF</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>23</th>
      <td>c0_Hx_HMFCA</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>24</th>
      <td>c0_Hx_FFCA</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
    <tr>
      <th>25</th>
      <td>c0_Hx_FDCA</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>nan</td>
      <td>0.0</td>
      <td>False</td>
      <td>-inf</td>
      <td>inf</td>
    </tr>
  </tbody>
</table>
</div><p>To assess the fit results the evolution of concentration over time and charge passed over time are plotted. For the concentrations evolution over time the lines correspond to the fit result and the points with errorbars to the experimental data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">chemical_kinetics</span> <span class="kn">import</span> <span class="n">plot</span>

<span class="n">plot</span><span class="o">.</span><span class="n">plot_c</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;HMF&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p align='center'><img src = HMF_oxidation_WO3_files/HMF_oxidation_WO3_36_0.svg
></p><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="o">.</span><span class="n">plot_c</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;DFF&quot;</span><span class="p">,</span> <span class="s2">&quot;HMFCA&quot;</span><span class="p">,</span> <span class="s2">&quot;FFCA&quot;</span><span class="p">,</span> <span class="s2">&quot;FDCA&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p align='center'><img src = HMF_oxidation_WO3_files/HMF_oxidation_WO3_37_0.svg
></p><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="o">.</span><span class="n">plot_q</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
<p align='center'><img src = HMF_oxidation_WO3_files/HMF_oxidation_WO3_38_0.svg
></p></div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="docs.html" class="btn btn-neutral float-right" title="Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="simple_example.html" class="btn btn-neutral float-left" title="Simple example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Florent Boudoire

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>